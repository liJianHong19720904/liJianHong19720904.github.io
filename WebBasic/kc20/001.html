<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    本例是本课程的结束篇的开局，我们将把包含310首唐诗文本作为数据，用来开发一个《唐诗三百首》软件项目。
    本例面对问题如下：
    1、全部310首唐诗文本作为一个字符串，我们的代码能正常分析处理每首诗吗？成功的关键是实现二点，一是前面的函数代码没有bug；二是唐诗文本数据基本规范。在本例中，我们可以测试出，到底哪个环节有问题，若发现问题，我们则进入分析问题和解决问题的计算思维模式，满足310首唐诗文本的数据量代码不是通过体力劳动能实现的，由此我们正好训练自己的抽象思维能力。
    2、本例作为初学者开发的一个项目，我们需要开始有“代码组织和架构”的意识，一般把代码组织在几个文件中，本例的文件由共有四个。
    3、前面二个文件是我们一直在使用的myCss.css和myJs.js，相当于本项目的基础代码。后面二个文件，一个是ts300.js，这个文件是全部310首唐诗文本，已经按格式做成了一个js代码文件，文件中只有一个全局变量ts300，我们将在本例使用自定义函数getTsFromString把唐诗数据处理出来。后面二个文件的第二个文件，就是本程序文件。
    4、为了让本例的代码组织结构更加清晰。我们把提前准备文件myCss.css、myJs.js、ts300.js都安排本文件在head元素内，让系统提前加载。
    5、还是为了让本例的代码组织结构更加清晰。我们把本例要用到的自定义函数，全部放在本文件在head元素内后面位置，也让系统提前加载，而本例写的项目软件相关代码则放在body结束位置。
    6、所有的程序动态输出都在Web页面的“ header ”区域实现，这也是转为初学者设计的格局，思路必须清晰，Web页面的其他地方都是静态内容。
    注：本课程由于专为初学者打造，几乎没有涉及对Web前端页面的控制，这个话题是后续课程的重点之一，但是为了让初学者又能使用Web页面丰富多彩的效果，本课程专门设计了二个函数： $ 和 my$ ，用来向页面的header页面区域输出，这两个函数都放在myJs.js文件中，后期的进阶课程会讨论这二个函数的实现。
    7、本课学习，可下载ts300.js文件到本地，让编程环境更便利。
  </title>
  <link rel = "stylesheet" type="text/css" href="../images/myCss.css">
  <script src="../images/myJs.js"></script>
  <script src="ts300.js"></script>
  <!--
    myCss.css 引入是为了导入前面12课的HTML/CSS页面样式的一个成熟成果，让页面具备较好外观和导航
    myJs.js 引入是为了导入本站特别为JavaScript 初级学习的 $函数代码
    ts300.js 引入则是为了把《 唐诗三百首 》文本当作字符串变量引入，变量名ts300 ，内含明清时代整理的三百一十首唐诗。该文本已经按前面课程的字符串模式排版。
  -->

  <script>
    //基本的字符串分析函数，search(s , ch) ，利用这个函数，我们可以得到字符ch在字符串 s 的每次出现的索引位置，结果以数组形式返回。
    function search( s , ch){
       var i = 0 ;
       var posAarr = [] ;
       while( s[i] ){
        if(s[i] === ch){
           posAarr[ lengthOfArray(posAarr) ] = i ;
           }
        i++ ; 
       }
       return posAarr ; 
       //字符串每个字符都遍历结束了，则返回数组。
     }//End search function
  
   //一个基本函数，用来返回数组或字符串的长度。
   function lengthOfArray(arr){
     var length = 0 ;
     var i = 0 ;
    while( arr[i] ) {
     length = length + 1 ;
     i = i + 1 ; //忘了这句将让代码陷入恐怖的死循环
     }
    return length ;
   } //End of function lengthOfArray(arr)
  
    
   function subString( s, p1 , p2 ){
     var subs = '' ;
     if(lengthOfArray(s) === 0 || (!parseInt(p1) && !parseInt(p2)) ){
       return '' ;
     }
     if(p1 > p2){
      var buf =  p1 ;
          p1 = p2 ;
          p2 = buf ;
     }
     
     if(p2 === undefined ){
      p2 = lengthOfArray(s)  ;
     }
     for(var i = p1 ; i < p2 ; i++){
      subs += s[i] ;
     }
     return subs ;
    } //End of subString( s, p1 , p2 )
  
  
   //为了让函数返getTsFromString回的唐诗数据更好使用，本例继续写出完整的getTsFromString函数，设计如下：
   function getTsFromString(ts){
      if(!ts){ 
          var ts = '291杜牧：泊秦淮\n烟笼寒水月笼沙，夜泊秦淮近酒家。商女不知亡国恨，隔江犹唱《后庭花》。\n292杜牧：寄扬州韩绰判官\n青山隐隐水迢迢，秋尽江南草未凋。二十四桥明月夜，玉人何处教吹箫？\n293杜牧：遣怀\n落魄江湖载酒行，楚腰纤细掌中轻。十年一觉扬州梦，赢得青楼薄幸名。\n294杜牧：秋夕\n银烛秋光冷画屏，轻罗小扇扑流萤。天阶夜色凉如水，坐看牵牛织女星。\n295杜牧：赠别二首之一\n娉娉袅袅十三馀，豆蔻梢头二月初。春风十里扬州路，卷上珠帘总不如。\n296杜牧：赠别二首之二\n多情却似总无情，唯觉樽前笑不成。蜡烛有心还惜别，替人垂泪到天明。\n297杜牧：金谷园\n繁华事散逐香尘，流水无情草自春。日暮东风怨啼鸟，落花犹似坠楼人。\n298李商隐：夜雨寄北\n君问归期未有期，巴山夜雨涨秋池。何当共剪西窗烛，却话巴山夜雨时？\n299李商隐：寄令狐郎中\n嵩云秦树久离居，双鲤迢迢一纸笔。休问梁园旧宾客，茂陵秋雨病相如。\n300李商隐：为有\n为有云屏无限娇，凤城寒尽怕春宵。无端嫁得金龟婿，辜负香衾事早朝。\n301李商隐：隋宫\n乘兴南游不戒严，九重谁省谏书函？春风举国裁宫锦，半作障泥半作帆。\n302李商隐：瑶池\n瑶池阿母绮窗开，黄竹歌声动地哀。八骏日行三万里，穆王何事不重来？\n303李商隐：嫦娥\n云母屏风烛影深，长河渐落晓星沈。嫦娥应悔偷灵药，碧海青天夜夜心。\n304李商隐：贾生\n宣室求贤访逐臣，贾生才调更无伦。可怜夜半虚前席，不问苍生问鬼神！\n' ;
      }
         
     var tsTitles = [] ;  //用来存放每首唐诗的标题
     var tsPoets = [] ;  //用来存放每首唐诗的诗文
     var tsPosArr =  search( ts, '\n' ) ;  
      // 命名来源于 ts Position Array
      //console.log(tsPosArr) ;
     var titleBegin = 0 ,
         titleEnd = tsPosArr[0] ,
         poetBegin = titleEnd + 1 ,
         poetEnd = tsPosArr[0+1] ;
         tsNumber = lengthOfArray( tsPosArr ) /2 ;
     for(var num = 1 ; num <= tsNumber ; num++){
      var tsTitle = subString(ts , titleBegin , titleEnd) ;
          tsTitles[ lengthOfArray(tsTitles) ] = tsTitle ;
  
      var tsPoet = subString(ts , poetBegin , poetEnd) ;
          tsPoets[ lengthOfArray(tsPoets) ] = tsPoet ;
  
        titleBegin = poetEnd + 1 ;
        titleEnd = tsPosArr[num * 2 ] ;
        poetBegin = titleEnd + 1 ;
        poetEnd = tsPosArr[num * 2 + 1] ;
     }  //循环处理每首唐诗结束
  
      // 本例继续处理tsTitles和tsPoets，实现诗文在每句独立出来，也让唐诗数据有更易理解，让写代码更方便使用的数据结构。
      // ts[ [唐诗1数组：标题1 ,  诗句1 , 诗句2 , ...]  , [唐诗2数组] ... ]
       ts = [] ;
       for(var i = 0 ; i < tsNumber ; i++ ){
         var poet = [] ;
          //本例用新创建的subString函数，把标题中的3位数字的文本编号消除
          poet[0] = subString(tsTitles[i], 3 ) ;
          poetContent = tsPoets[i] ;
          var j = 0 ; //记录唐诗诗文字符串的下标索引
          var s = '' ; //存放单独成句的每句唐诗
          while( poetContent[j] ){
           var sign = poetContent[j] ;
           if(sign == '，' || sign == '。' || sign == '！' || sign == '？' ){
            s += sign  ; 
            poet[ lengthOfArray(poet) ] = s ;
            s = '' ;
           }else{
            s += sign  ; 
           }
            j++ ;
          }
         ts[ lengthOfArray(ts) ] = poet ;
       }
       return ts ;
     } //End of getTsFromString()
  
    </script>
 </head>
 
 <body>
  
  <header>
    欢迎打开《唐诗三百首》软件
  </header>

   <article>
 	  <strong> 代码组织架构 </strong>
    <img src="../images/girl2.jpg">
  </article>
  <footer>
    Box-Model & Float & Position  By Li CopyRight 2022
  </footer>
  
  <script>

 
  //本例代码如下：
  //定义全局变量ts 存放唐诗数据处理函数getTsFromString的返回值。
 
  var ts = getTsFromString(ts300) ;
  /**** 注意：按getTsFromString的算法设计，变量ts的数据结构为：
   // ts[ [唐诗1数组：标题1 ,  诗句1 , 诗句2 , ...]  , [唐诗2数组] ... ]
   ****/

  $('导入唐诗共计：' + lengthOfArray(ts)  + ' 首。' ) ;
  
  $('下面输出唐诗数组中，下标索引能整除99的3首唐诗：' ) ;
  var i , j ;
  for ( i= 99 ; i < lengthOfArray(ts) ; i += 99){
    var poet = ts[i] ;
    $('No.' + i + ':');
     for(j=0; j < lengthOfArray(poet) ; j++){
        $( poet[j] );
    } 
  }
  $('项目第1步，搭建"代码组织架构"结束！' ) ;
  $('下一步，对接前面的HTML/CSS静态效果，为程序写一个UI！' ) ;

 </script>

 </body>
</html>
